---
import Base from "@/layouts/Base.astro";
import config from "@/config/config.json";
import social from "@/config/social.json";

const { contact_form_action, discord_url }: { contact_form_action: string; discord_url?: string } = config.params;

// mapear ids simples -> iconify ids
const iconMap: Record<string, string> = {
  instagram: "tabler:brand-instagram",
  facebook: "tabler:brand-facebook",
  twitter: "tabler:brand-twitter",
  tiktok: "tabler:brand-tiktok",
  youtube: "tabler:brand-youtube",
};
const resolveIcon = (id?: string) =>
  id?.includes(":") ? id! : (iconMap[id?.toLowerCase() || ""] || "tabler:alert-circle");

const allowed = new Set(["Instagram", "Facebook", "TikTok", "YouTube"]);
const socials = (social?.main ?? []).filter((s) => allowed.has(s.name));
---

<Base title="AuroEscape-Contacto">
  <main class="pt-24">
    <section class="mx-auto max-w-6xl px-4">
      <h1 class="text-4xl font-extrabold">Ponte en contacto</h1>
      <p class="mt-2 text-text-light dark:text-darkmode-text-light">Preguntas sobre nuestros cursos o comunidad. Te respondemos pronto.</p>

      <!-- Discord + Redes -->
      <div class="mt-10 grid gap-6 md:grid-cols-2">
        <div id="discord" class="rounded-2xl border p-6 dark:border-darkmode-border">
          <h2 class="text-2xl font-extrabold">Discord</h2>
          <p class="mt-2 text-text-light dark:text-darkmode-text-light">Únete a nuestro Discord para compartir progreso y resolver dudas.</p>
          <a href={discord_url || "#"} class="mt-4 inline-block rounded-full border px-5 py-2 hover:bg-light dark:hover:bg-darkmode-light">
            Entrar al Discord
          </a>
        </div>

        <div class="rounded-2xl border p-6 dark:border-darkmode-border">
          <h2 class="text-2xl font-extrabold">Síguenos</h2>
          <p class="mt-2 text-text-light dark:text-darkmode-text-light">Estamos activos en nuestras redes.</p>
          <ul class="mt-4 flex flex-wrap items-center gap-3">
            {socials.map((s) => (
              <li>
                <a
                  aria-label={s.name}
                  href={s.link}
                  target="_blank"
                  rel="noopener noreferrer nofollow"
                  class="inline-flex items-center gap-2 rounded-full border px-4 py-2 hover:bg-light dark:hover:bg-darkmode-light"
                  title={s.name}
                >
                  <iconify-icon icon={resolveIcon(s.icon)} width="18" height="18"></iconify-icon>
                  <span class="text-sm font-medium">{s.name}</span>
                </a>
              </li>
            ))}
          </ul>
        </div>
      </div>

      <!-- Formulario -->
      <form action={contact_form_action || "#"} method="post" class="mt-10 grid gap-6">
        <div class="grid sm:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium mb-1">Nombre</label>
            <input type="text" name="name" class="w-full rounded-xl border border-gray-300 px-4 py-3 dark:bg-darkmode-light dark:border-darkmode-border" placeholder="Tu nombre" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Email</label>
            <input type="email" name="email" class="w-full rounded-xl border border-gray-300 px-4 py-3 dark:bg-darkmode-light dark:border-darkmode-border" placeholder="tucorreo@ejemplo.com" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Curso</label>
          <select name="course" class="w-full rounded-xl border border-gray-300 px-4 py-3 dark:bg-darkmode-light dark:border-darkmode-border">
            <option>Iniciación al Skate</option>
            <option>Trucos Intermedios</option>
            <option>Avanzado &amp; Competición</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Mensaje</label>
          <textarea rows={6} name="message" class="w-full rounded-xl border border-gray-300 px-4 py-3 dark:bg-darkmode-light dark:border-darkmode-border" placeholder="Cuéntanos en qué te ayudamos"></textarea>
        </div>

        <div>
          <button class="inline-flex items-center rounded-full bg-emerald-600 text-white px-6 py-3 font-semibold hover:bg-emerald-700">
            Enviar
          </button>
        </div>
      </form>
    </section>
  </main>

  <!-- Fallback por si el script de Iconify no cargó desde Base -->
  <script is:inline>
    if (!customElements.get('iconify-icon')) {
      const s = document.createElement('script');
      s.src = 'https://unpkg.com/@iconify-icon/web@2.1.0/dist/iconify-icon.min.js';
      s.defer = true;
      document.head.appendChild(s);
    }
  </script>
</Base>
