---
import config from "@/config/config.json";
import ImageMod from "./ImageMod.astro";

const { src, srcDarkmode }: { src?: string; srcDarkmode?: string } = Astro.props;

const {
  logo,
  logo_darkmode,
  logo_width,
  logo_height,
  logo_text,
  title,
}: {
  logo: string;
  logo_darkmode: string;
  logo_width: string;   // vienen como "160px"
  logo_height: string;  // vienen como "40px"
  logo_text: string;
  title: string;
} = config.site;

const { theme_switcher }: { theme_switcher: boolean } = config.settings;

// normalizamos medidas
const w = Number(logo_width?.replace("px", "") || 0);
const h = Number(logo_height?.replace("px", "") || 0);
---

<style is:global>
  /* Fallback por si las utilidades dark: no estuvieran disponibles */
  .logo-light { display:inline-block; }
  .logo-dark  { display:none; }
  .dark .logo-light { display:none; }
  .dark .logo-dark  { display:inline-block; }
</style>

<a href="/" class="navbar-brand inline-block" aria-label={title}>
  {src || srcDarkmode || logo || logo_darkmode ? (
    <>
      <!-- Versión clara -->
      <span class={`logo-light ${theme_switcher ? "dark:hidden" : ""}`}>
        <ImageMod
          src={src ?? logo}
          class="block"
          width={w * 2}
          height={h * 2}
          alt={title}
          style={{ height: `${h}px`, width: `${w}px` }}
          format="webp"
        />
      </span>

      <!-- Versión oscura (solo si hay theme_switcher) -->
      {theme_switcher && (
        <span class="logo-dark hidden dark:inline-block">
          <ImageMod
            src={srcDarkmode ?? logo_darkmode}
            class="block"
            width={w * 2}
            height={h * 2}
            alt={title}
            style={{ height: `${h}px`, width: `${w}px` }}
            format="webp"
          />
        </span>
      )}
    </>
  ) : logo_text ? (
    logo_text
  ) : (
    title
  )}
</a>
