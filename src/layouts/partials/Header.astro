---
import AnnouncementBar from "@/layouts/components/AnnouncementBar.astro";
import Logo from "@/layouts/components/Logo.astro";
import menu from "@/config/menu.json";
import ThemeSwitcher from "@/layouts/components/ThemeSwitcher.astro";
import Cart from "@/layouts/functional-components/cart/Cart.astro"; // carrito original
// Detectamos si estamos en /products o /cursos para aplicar un padding extra al main desde Base
const { url } = Astro;
const isCursos = url.pathname.startsWith("/products") || url.pathname.startsWith("/cursos");
---

<style>
  /* Header translúcido fijo arriba */
  .site-header {
    position: sticky;
    top: 0;
    z-index: 50;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background: rgba(0,0,0,0.55); /* translúcido siempre */
    border-bottom: 1px solid rgba(255,255,255,.08);
  }

  /* Contenedor a 3 columnas: izq logo, centro nav, der acciones */
  .header-grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    min-height: 64px;
    gap: 16px;
  }

  .left,
  .right { display: flex; align-items: center; gap: 14px; }

  .left { justify-content: flex-start; }
  .center { display:flex; justify-content:center; }
  .right { justify-content: flex-end; }

  nav a {
    color: rgba(255,255,255,.85);
    font-weight: 600;
    letter-spacing: .2px;
  }
  nav a:hover { color: #fff; }

  /* Botones redondos a la derecha  */
  .icon-btn{
    display:inline-flex; align-items:center; justify-content:center;
    width:34px; height:34px; border-radius:9999px;
    border:1px solid rgba(255,255,255,.25);
    background: transparent;
    transition: background .2s ease;
  }
  .icon-btn:hover{ background: rgba(255,255,255,.10); }

  /* Evitar que el icono del carrito cambie de color con el tema */
  .cart-icon { color:#fff !important; fill:#fff !important; }

  /* Asegurar tamaño/estética del botón cuando se mueve dentro del anchor */
  #cart-anchor > #cartOverlay {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 9999px;
    border: 1px solid rgba(255,255,255,.25);
    background: transparent;
    transition: background .2s ease;
  }
  #cart-anchor > #cartOverlay:hover { background: rgba(255,255,255,.10); }
  #cart-anchor > #cartOverlay svg { color:#fff !important; fill:#fff !important; }

  /* En móviles, el nav centra igual y se oculta en xs si quieres */
  @media (max-width: 768px){
    nav { gap: 18px; font-size: 14px; }
  }
</style>

<header class="site-header">
  <div class="container">
    <div class="header-grid">
      <!-- IZQUIERDA: logo bien pegado a la izquierda -->
      <div class="left">
        <a href="/" aria-label="Inicio" class="inline-flex items-center">
          <Logo />
        </a>
      </div>

      <!-- CENTRO: navegación -->
      <div class="center">
        <nav class="flex items-center gap-8">
          <a href="/" class="hover:opacity-100">Inicio</a>
          <a href="/products" class="hover:opacity-100">Cursos</a>
          <a href="/contact" class="hover:opacity-100">Contacto</a>
        </nav>
      </div>


     <!-- DERECHA: Tema -> Carrito (MISMAS piezas, bien ubicadas) -->
      <div class="absolute inset-y-0 right-100 flex items-center gap-4 z-40">
        <ThemeSwitcher />
        <Cart />  <!-- ⬅️ respetamos tu componente original -->
      </div>
    </div>
  </div>
    </div>
  </div>
</header>

<!-- Ajuste de padding superior del contenido para que nada quede tapado por la cabecera -->
{isCursos
  ? <style is:global>{`:root{--header-offset:92px}@media(max-width:768px){:root{--header-offset:96px}}main{padding-top:var(--header-offset)}`}</style>
  : <style is:global>{`:root{--header-offset:64px}@media(max-width:768px){:root{--header-offset:68px}}main{padding-top:var(--header-offset)}`}</style>
}

<script type="module">
  // Mueve el botón del carrito (#cartOverlay) a la derecha del toggle (dentro de #cart-anchor)
  const moveCart = () => {
    const anchor = document.getElementById("cart-anchor");
    const overlay = document.getElementById("cartOverlay"); // tu ID del carrito
    if (anchor && overlay && overlay.parentNode !== anchor) {
      anchor.innerHTML = "";
      anchor.appendChild(overlay);
      // asegurar estilos/colores
      overlay.style.display = "";
      overlay.classList.add("cart-icon");
    }
  };

  window.addEventListener("load", moveCart);
  document.addEventListener("astro:after-swap", moveCart);

  // Si el trigger se hidrata más tarde, lo reubicamos automáticamente
  const obs = new MutationObserver(() => moveCart());
  obs.observe(document.documentElement, { childList: true, subtree: true });
</script>
